---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { blogPosts } from "../../data/blogData";
import { marked } from "marked";

export function getStaticPaths() {
  return blogPosts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { slug } = Astro.params;

// Meta-Tags für diesen speziellen Placeholder
const isPlaceholder = slug === "welcome-to-our-blog";

const contentHtml = await marked.parse(post.content);

// Schema Markup
const absoluteImage = post.image
  ? post.image.startsWith("http")
    ? post.image
    : `https://ki-automatisieren.de${post.image}`
  : "https://ki-automatisieren.de/og-homepage.jpg";

const schema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: post.title,
  datePublished: post.date,
  dateModified: post.date,
  author: {
    "@type": "Person",
    name: post.author,
  },
  publisher: {
    "@type": "Organization",
    name: "KI Automatisieren",
    logo: {
      "@type": "ImageObject",
      url: "https://ki-automatisieren.de/logo.png",
    },
  },
  image: absoluteImage,
  articleBody: post.content.substring(0, 500),
  keywords: post.tags.join(", "),
  articleSection: post.category,
});
---

<BaseLayout
  title={post.title}
  description={post.excerpt}
  image={post.image}
  type="article"
>
  {
    isPlaceholder && (
      <meta slot="head" name="robots" content="noindex, nofollow" />
    )
  }
  <script type="application/ld+json" set:html={schema} />

  <div
    class="mx-auto w-full max-w-3xl px-4 py-12 min-h-screen"
    style="background: #0B0F14;"
  >
    {
      post.image && (
        <img
          src={post.image}
          alt={post.title}
          class="w-full h-auto rounded-lg mb-8"
          loading="lazy"
          width="800"
          height="450"
        />
      )
    }

    <h1 class="text-3xl md:text-4xl font-semibold mb-4 text-slate-200">
      {post.title}
    </h1>

    <div class="flex items-center gap-4 mb-6 text-slate-400">
      <span>{post.author}</span>
      <span>•</span>
      <span>{post.date}</span>
      <span>•</span>
      <span>{post.readTime} Min</span>
    </div>

    {
      post.tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mb-8">
          {post.tags.map((tag) => (
            <span
              class="px-3 py-1 rounded-full text-sm"
              style="background: rgba(163, 230, 53, 0.1); color: #A3E635;"
            >
              #{tag}
            </span>
          ))}
        </div>
      )
    }

    <article
      class="prose prose-invert prose-lg max-w-none text-slate-300"
      set:html={contentHtml}
    />

    <div
      class="mt-12 p-6 rounded-lg"
      style="background: rgba(255, 255, 255, 0.05);"
    >
      <h2 class="text-lg font-semibold mb-2 text-slate-200">Über den Autor</h2>
      <p class="text-slate-400">{post.author}</p>
    </div>
  </div>
</BaseLayout>
