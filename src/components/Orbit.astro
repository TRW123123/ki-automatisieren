---
const { items } = Astro.props;
---

<div id="orbit-container" class="relative w-full py-12 md:py-24 bg-[#0B0F14] overflow-hidden min-h-[500px] md:min-h-[700px]">
  <div class="container mx-auto px-4 relative z-10 flex flex-col items-center">
    
    <!-- Header -->
    <div class="text-center mb-16 md:mb-24 z-20">
      <h2 class="text-3xl md:text-5xl font-bold mb-4 text-white">Von Null bis Stammkunde: <span class="text-lime-400">End-to-End-Automation</span></h2>
      <p class="text-slate-400 text-lg max-w-2xl mx-auto">
        Automatische Kundengewinnung in 5 Phasen.
      </p>
    </div>

    <!-- Orbit System (Desktop) -->
    <div id="orbit-system" class="relative w-full max-w-[800px] aspect-square hidden md:block">
        <!-- Background Glow -->
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(163,230,53,0.1),transparent_70%)] pointer-events-none"></div>

        <!-- Rings -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="w-[60%] h-[60%] border border-white/5 rounded-full absolute"></div>
            <div class="w-[85%] h-[85%] border border-white/5 rounded-full absolute"></div>
        </div>

        <!-- Central Core -->
        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-24 bg-[#0B0F14] border-2 border-lime-500/20 rounded-full flex items-center justify-center z-10 shadow-[0_0_30px_rgba(163,230,53,0.2)]">
            <div class="w-8 h-8 bg-lime-500 rounded-full animate-pulse"></div>
        </div>

        <!-- Planetary Nodes -->
        <div id="orbit-nodes-container" class="absolute inset-0">
            {items.map((item, index) => (
                <div 
                    class="orbit-node absolute w-16 h-16 cursor-pointer group transition-all duration-300"
                    data-index={index}
                    data-title={item.title}
                    data-desc={item.desc}
                    role="button"
                    aria-label={`Show ${item.title}`}
                >
                    <!-- Node Circle -->
                    <div class="w-full h-full bg-[#111827] border-2 border-white/20 rounded-full flex items-center justify-center hover:border-lime-400 hover:scale-110 hover:shadow-[0_0_20px_rgba(163,230,53,0.4)] transition-all z-20 relative">
                        {/* Dynamic Icons based on Title/Index mapping */}
                        <div class="text-lime-400">
                             {index === 0 && <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>}
                             {index === 1 && <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 11 18-5v12L3 14v-3z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></svg>}
                             {index === 2 && <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>}
                             {index === 3 && <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7.8 8.2 2.7 2.6c.8.8 2 .8 2.8 0l2.7-2.6a4 4 0 0 0-5.6-5.6l-.1.1-.1-.1a4 4 0 0 0-5.6 5.6z"/><path d="M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18z"/></svg>}
                             {index === 4 && <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2h4"/><path d="M12 14v-7"/><path d="M20 14h-6.2a1 1 0 0 1-.8-.4l-1.3-1.6a2 2 0 0 0-3.4 0l-1.3 1.6a1 1 0 0 1-.8.4H4a2 2 0 0 0-2 2v2"/><path d="M22 18v2a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-2"/></svg>}
                        </div>
                    </div>
                    <!-- Label below node -->
                    <div class="absolute -bottom-8 left-1/2 -translate-x-1/2 whitespace-nowrap text-sm font-medium text-slate-300 group-hover:text-lime-400 transition-colors">
                        {item.title}
                    </div>
                </div>
            ))}
        </div>

        <!-- Center Details Card (Hidden by default, shown via JS) -->
        <div id="orbit-details-card" class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[320px] bg-[#111827]/95 backdrop-blur-md border border-lime-500/30 rounded-2xl p-6 shadow-2xl opacity-0 scale-90 pointer-events-none transition-all duration-300 z-30">
            <div class="text-lime-400 mb-2 font-bold uppercase tracking-wider text-xs" id="card-category">Phase</div>
            <h3 class="text-xl font-bold text-white mb-3" id="card-title">Title</h3>
            <p class="text-slate-300 text-sm leading-relaxed" id="card-desc">Description goes here.</p>
            <button id="close-card" class="absolute top-4 right-4 text-slate-500 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
    </div>

    <!-- Mobile Stack (Visible only on Mobile) -->
    <div class="md:hidden w-full flex flex-col gap-6">
        {items.map((item, index) => (
             <div class="bg-[#111827] border border-white/10 p-6 rounded-2xl flex items-start gap-4">
                 <div class="w-12 h-12 bg-lime-500/10 rounded-full flex-shrink-0 flex items-center justify-center text-lime-400">
                     <span class="font-bold">{index + 1}</span>
                 </div>
                 <div>
                     <h3 class="text-white font-bold text-lg mb-2">{item.title}</h3>
                     <p class="text-slate-400 text-sm leading-relaxed">{item.desc}</p>
                 </div>
             </div>
        ))}
    </div>

  </div>
</div>

<script>
    // Pure Vanilla JS for Orbit Animation
    document.addEventListener('DOMContentLoaded', () => {
        const desktopContainer = document.getElementById('orbit-system');
        // Only run if desktop container exists
        if (!desktopContainer) return;

        const nodes = document.querySelectorAll('.orbit-node');
        const card = document.getElementById('orbit-details-card');
        const cardTitle = document.getElementById('card-title');
        const cardDesc = document.getElementById('card-desc');
        const cardCat = document.getElementById('card-category');
        const closeBtn = document.getElementById('close-card');
        
        // System Config
        const radius = 300; // Radius of orbit
        let angle = 0;
        let isPaused = false;
        let activeIndex = -1;
        let animationFrameId;

        // Initialize Positions
        function updatePositions() {
            // STOP ROTATION: User requested static
            // if (!isPaused) {
            //    angle += 0.002; // Rotation speed
            // }
            
            const centerX = desktopContainer.offsetWidth / 2;
            const centerY = desktopContainer.offsetHeight / 2;

            nodes.forEach((node, index) => {
                // Calculate individual angle: base angle + offset based on index
                const offset = (index / nodes.length) * (2 * Math.PI);
                const currentAngle = angle + offset;

                // Orbit Math
                const x = centerX + Math.cos(currentAngle) * radius - 32; // -32 for half node width (64px/2)
                const y = centerY + Math.sin(currentAngle) * radius - 32;

                // Apply Position
                // We use transform directly for performance
                // @ts-ignore
                node.style.transform = `translate(${x}px, ${y}px)`;
            });

            // STOP ANIMATION LOOP: Static on first render
            // animationFrameId = requestAnimationFrame(updatePositions);
        }

        // Handle Click on Node
        nodes.forEach((node, index) => {
            node.addEventListener('click', () => {
                // Stop rotation
                isPaused = true;
                activeIndex = index;

                // Update Card Content
                // @ts-ignore
                cardTitle.textContent = node.dataset.title;
                // @ts-ignore
                cardDesc.textContent = node.dataset.desc;
                // @ts-ignore
                cardCat.textContent = `Phase ${index + 1}`;

                // Show Card
                card.classList.remove('opacity-0', 'scale-90', 'pointer-events-none');
                card.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');

                // Hilight active node, dim others
                nodes.forEach((n, i) => {
                    if (i === index) {
                         n.classList.add('scale-125', 'border-lime-400', 'z-50');
                         n.classList.remove('opacity-50');
                    } else {
                         n.classList.remove('scale-125', 'border-lime-400', 'z-50');
                         n.classList.add('opacity-50');
                    }
                });
            });
        });

        // Close Card & Resume
        closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            resetOrbit();
        });

        // Click outside to reset
        document.addEventListener('click', (e) => {
            // @ts-ignore
            if (!e.target.closest('.orbit-node') && !e.target.closest('#orbit-details-card')) {
                resetOrbit();
            }
        });

        function resetOrbit() {
            isPaused = false;
            activeIndex = -1;
            
            // Hide Card
            card.classList.add('opacity-0', 'scale-90', 'pointer-events-none');
            card.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');

            // Reset Nodes
            nodes.forEach(n => {
                n.classList.remove('scale-125', 'border-lime-400', 'z-50', 'opacity-50');
            });
        }

        // Start Animation
        updatePositions();
    });
</script>
